let suscribersApp=new Vue({el:"#suscriptionApp",data:{events:[],users:[{name:"",telephone:"",email:"",paymentMethod:"coupon",valid:!1,validPayment:!1,couponCode:"",couponCodeSec:"",couponPartner:"",paymentDate:"",payout:0}],system:{selectedEvent:0,selectedUser:0,usersQuantity:0,userSaved:!1,step:0,payPalUser:"",loadingGif:!1},alert:{modalText:""},loading:{modalText:""}},created(){},methods:{checkAllAndSubmit(){2==this.system.usersQuantity&&(this.users[0].couponCode=this.users[1].couponCode,this.users[0].couponCodeSec=this.users[1].couponCodeSec,this.users[0].paymentMethod=this.users[1].paymentMethod,this.users[0].couponPartner=this.users[1].name,this.users[1].couponPartner=this.users[0].name,"dev"==env&&console.log("Se copiaron los métodos de pago exitosamente."));let e=()=>{let e={data:{user:this.users[this.system.selectedUser],eventId:this.events[this.system.selectedEvent]._id,paymentMethod:this.events[this.system.selectedUser].paymentMethod},url:baseUrl+"/api/user/add/class",method:"post"};axios(e).then(e=>{e.data.error?this.alert.modalText=`${2==this.system.usersQuantity?"No se pudo guardar ninguna reserva.":`No se pudo guardar la reserva de ${this.users[0].name}.`}`:("Ya estabas registrado aquí, no puedes hacerlo nuevamente."==e.data.result&&(document.getElementById("blockWhenUserIsAlreadyRegistered").style.display="none"),this.system.userSaved=!0,this.loading.modalText+=" "+e.data.result,this.system.step++,document.getElementById("paypal-button-container").innerHTML=""),this.system.loadingGif=!1}).catch(this.system.loadingGif=!0),setTimeout(function(){"dev"!=env&&(document.getElementById("main-header").style.zIndex="1")},5e3)};this.system.selectedUser=0,this.checkUser()?e():this.alert.modalText="Parece que has cambiado un dato que invalidó tu reserva. ¡Prueba de nuevo!",2==this.system.usersQuantity&&(this.system.selectedUser=1,this.checkUser()&&e())},humanize:e=>e?e.replace(/-/g," ").replace(/\b[a-z]/,e.charAt(0).toUpperCase()):e,translatePayment:e=>"cash"==e?"Efectivo":"coupon"==e?"Cupón":"credit"==e?"Tarjeta de débito/crédito":"relapse"==e?"Recaída":void 0,generateCouponCode:()=>parseInt(1e8*Math.random()),resetAll(){for(let e=0;e<this.users.length;e++)this.users.pop();this.users.push({name:"",telephone:"",email:"",paymentMethod:"coupon",valid:!1,validPayment:!1,couponCode:"",couponCodeSec:"",couponPartner:"",paymentDate:"",payout:0}),this.system.selectedUser=0,this.system.step=0,this.alert.modalText="",this.loading.modalText=""},goBack(){this.system.step>0&&this.system.step--},goNext(){this.system.step<3&&this.system.step++},reloadEvents(){this.events=eventsApp.events,this.system.selectedEvent=eventsApp.system.selectedEvent},checkSuscribersQuantity:()=>!0,isValidEmail(e){var s=/\S+@\S+\.\S+/;let t=s.test(e);return t},checkUser(){return this.alert.modalText="",this.users[this.system.selectedUser].name.split(" ").length<2?this.alert.modalText="Por favor, escribe tu nombre y apellido.":this.users[this.system.selectedUser].telephone.length<9?this.alert.modalText="El teléfono debe tener al menos 9 caracteres.":this.isValidEmail(this.users[this.system.selectedUser].email)||(this.alert.modalText="Introduce un e-mail válido."),""==this.alert.modalText?(this.users[this.system.selectedUser].valid=!0,!0):(this.users[this.system.selectedUser].valid=!1,!1)},loadPaymentWindow(){let e=this.checkUser();"dev"==env&&console.log(`El usuario es ${e?"válido":"inválido"}.`),e?(this.alert.modalText="",this.loading.modalText="Todos tus datos son válidos.",this.system.usersQuantity>this.users.length&&(this.users.push({name:"",telephone:"",email:"",paymentMethod:this.users[0].paymentMethod,valid:!1,validPayment:!1,couponCode:"",couponCodeSec:"",couponPartner:"",paymentDate:"",payout:0}),this.system.selectedUser=1),this.goNext()):(this.system.selectedUser=0,this.alert.modalText="Revisa que tu e-mail, teléfono, nombre y apellido estén bien escritos.",this.loading.modalText="",this.goBack())},checkPayment(){const e={url:baseUrl+"/api/user/warranty",data:{email:this.users[this.system.selectedUser].email,couponCodeToSearch:this.users[this.system.selectedUser].couponCode},method:"post"};this.alert.modalText="",this.loading.modalText="","coupon"==this.users[this.system.selectedUser].paymentMethod&&this.users[this.system.selectedUser].couponCode.length>1&&this.users[this.system.selectedUser].couponCodeSec.length>1?this.users[this.system.selectedUser].validPayment=!0:"relapse"==this.users[this.system.selectedUser].paymentMethod?axios(e).then(e=>{e.data.error?this.alert.modalText=e.data.result:this.loading.modalText=e.data.result,this.users[this.system.selectedUser].validPayment=!e.data.error}).catch():"credit"==this.users[this.system.selectedUser].paymentMethod?(this.loading.modalText='Ahora cliquea "Pagar con PayPal"',this.alert.modalText=""):(this.users[this.system.selectedUser].validPayment=!1,this.alert.modalText="Escribe correctamente los datos."),"coupon"!=this.users[0].paymentMethod&&"relapse"!=this.users[0].paymentMethod&&(this.users[0].couponCode=this.generateCouponCode())},togglePayPalWindow(){document.getElementById("suscriptionWindow").style.zIndex=-1==document.getElementById("suscriptionWindow").style.zIndex?1:-1,document.getElementById("payPalWindow").style.left="-100%"==document.getElementById("payPalWindow").style.left?"0":"-100%",""==document.getElementById("paypal-button-container").innerHTML&&(10!=this.users[this.system.usersQuantity-1].payout&&"cash"==this.users[this.system.selectedUser].paymentMethod?payPal(10):50==this.users[this.system.usersQuantity-1].payout&&90==this.users[this.system.usersQuantity-1].payout||payPal(1==this.system.usersQuantity?"50":"90"))}},delimiters:["[[","]]"]});
let panel=new Vue({el:"#app",data:{categories:{items:[],count:0,edit:{}},directions:{items:[],count:0,edit:{}},events:{items:[],count:0,edit:{},customers:[]},customers:{items:[],selected:{items:[],activated:!1},search:{result:[],filter:"",key:""},count:0,pages:0,edit:""},search:{filter:"",query:""},alert:{normalText:"",modalText:""},loading:{normalText:"",modalText:""},online:!0},created(){this.getCategories()},methods:{stringToColor(e){for(var t=0,s=0;s<e.length;s++)t=e.charCodeAt(s)+((t<<5)-t);var a="#";for(s=0;s<3;s++){var i=t>>8*s&255;a+=("00"+i.toString(16)).substr(-2)}return a},sortByDate:(e,t)=>(e.sort(function(e,s){let a=e.dateAndTime.split("-")[1].localeCompare(s.dateAndTime.split("-")[1]);return a*t}),e),flushModals(){this.alert.modalText="",this.alert.normalText="",this.loading.modalText="",this.loading.normalText=""},humanize:e=>(e=e.replace(/-/g," "),e=e.replace(/\b[a-z]/,e[0].toUpperCase()),e),translatePaymentMethod:e=>"cash"==e?"Efectivo":"coupon"==e?"Cupón":"credit"==e?"PayPal":"bank"==e?"Banco":"relapse"==e?"Recaída":void 0,togglePassword(e){let t=document.getElementById(e);"password"==t.type?t.type="text":t.type="password"},deleteFrontEndItem(e,t){let s=e.map(function(e){return e._id}).indexOf(t);return s>=0&&(e.splice(s,1),!0)},getCategories(){this.loading.normalText="Cargando categorías",0==this.categories.items.length?axios.get("/api/categories/get").then(e=>{e.data.sort(function(e,t){return e.name.localeCompare(t.name)}),this.categories.items=[...e.data],this.categories.items.length>0&&(this.loading.normalText="")}):this.loading.normalText=""},createCategory(){const e={url:"/api/category/create",method:"post",data:{category:this.categories.edit}};axios(e).then(e=>{e.data.error?this.alert.modalText="No pudo crearse esta categoría. Intentelo nuevamente.":(this.categories.items.unshift(e.data.category),this.loading.normalText="Categoría creada exitosamente",UIkit.modal(document.getElementById("create-category")).toggle())}).catch()},setDescriptionOfNewCategory(){this.categories.edit.description="Seminarios dedicados a "+this.categories.edit.name},editCategory(){const e={url:"/api/category/edit",method:"post",data:{editedCategory:this.categories.edit}};axios(e).then(e=>{e.data.error?this.alert.normalText="No pudo editarse la categoría. Intenta más tarde.":this.loading.normalText="Se editó la categoría correctamente."}).catch(),UIkit.modal(document.getElementById("edit-category")).toggle()},deleteCategory(e){const t={url:"/api/category/delete/"+e,method:"get"};axios(t).then(t=>{t.data.error?this.alert.modalText="No se pudo eliminar esta categoría, intente más tarde.":(this.deleteFrontEndItem(this.categories.items,e),this.loading.normalText="Se eliminó correctamente la categoría.",UIkit.modal(document.getElementById("edit-category")).toggle())})},getDirections(){this.loading.normalText="Cargando direcciones",0==this.directions.items.length?axios.get("/api/directions/get/").then(e=>{this.directions.items=[...e.data],this.directions.items.sort(function(e,t){return e.province.localeCompare(t.province)}),this.directions.items.length>0&&(this.loading.normalText="")}):this.loading.normalText=""},createDirection(){const e={url:"/api/direction/create",method:"post",data:{direction:this.directions.edit}};axios(e).then(e=>{e.data.error?this.alert.modalText="No se pudo crear esta dirección. Intentelo nuevamente.":(this.loading.normalText="Dirección creada correctamente.",this.directions.items.unshift(e.data.direction),UIkit.modal(document.getElementById("create-direction")).toggle())})},deleteDirection(e){axios.get("/api/direction/delete/"+e).then(t=>{t.data.error?this.alert.normalText="No pudo eliminarse la dirección. Intentelo nuevamente.":(this.deleteFrontEndItem(this.directions.items,e),this.loading.normalText="Se eliminó la dirección exitosamente.",UIkit.modal(document.getElementById("edit-direction")).toggle())})},getEvents(e){this.loading.normalText="Cargando eventos",0==this.events.items.length?axios.get("/api/event/get/"+15*e).then(e=>{this.events.items=this.sortByDate(e.data.result,-1),this.events.items.length>0&&(this.loading.normalText="")}):this.loading.normalText=""},getEventById(e){let t=0;for(;this.events.items[t]._id!=e;)t++;this.events.items[t]._id==e?this.events.edit=this.events.items[t]:this.alert.normalText="No se encontró este evento"},createEvent(){this.events.edit={category:"adelgazar",limit:"",suscribers:0,date:"",time:"",location:"Av. de las Naciones, s/n Playa de San Juan, Alicante",locationPassword:"",isVirtual:!1}},saveEvent(){let e={url:"/api/event/create",method:"post",data:{event:this.events.edit}};axios(e).then(e=>{e.data.error?this.alert.modalText="No se pudo crear el evento. Intentelo nuevamente.":(this.loading.modalText="El evento se creo correctamente",this.events.edit.dateAndTime=this.events.edit.date+", "+this.events.edit.time,this.events.items.unshift(this.events.edit))})},editEvent(e){const t={url:`/api/event/edit/${e}`,method:"post",data:{editedEvent:this.events.edit}};axios(t).then(e=>{e.data.error?this.alert.modalText="No pudo editarse este evento. Intentelo nuevamente.":this.loading.modalText="Se editó el evento correctamente."})},getCustomersFromEvent(e){this.events.customers=[],this.loading.modalText="Cargando clientes",axios.get("/api/event/get/customers/"+e).then(t=>{this.events.customers=[...t.data],this.events.customers.length>0&&(this.loading.modalText="");let s=this.events.items.map(function(e){return e.dateAndTime}).indexOf(e);this.events.items[s].suscribers=this.events.customers.length;for(let e=0;e<this.events.customers.length;e++)this.events.customers[e].classes[0].color=this.stringToColor(this.events.customers[e].classes[0].couponCode),console.log(this.events.customers[e].classes[0].color)}),this.events.customers.length>0?this.loading.modalText="":this.loading.modalText="No hay clientes que mostrar"},changeAssist(e,t,s){let a={url:"/api/user/edit/assist",method:"post",data:{userId:e,classId:s}};axios(a).then(e=>{console.log(e.data),e.data.error?this.alert.modalText="Hubo un error al cambiar la asistencia de "+this.events.customers[t].name+".":(this.loading.modalText="Se cambió la asistencia correctamente.",this.events.customers[t].classes[0].assist=e.data.result)})},changePayout(e,t){let s={url:"/api/user/edit/payout",method:"post",data:{userId:e,classId:t,payout:0}},a=0;for(;this.events.customers[a]._id!=e;)a++;this.events.customers[a]._id==e&&(s.data.payout=this.events.customers[a].classes[0].payout,axios(s).then(e=>{e.data.error?this.alert.modalText="Hubo un error al cambiar el pago de "+this.events.customers[a].name+".":this.loading.modalText="Se cambió el monto pagado por "+this.events.customers[a].name+"."}))},deleteEvent(e){axios.get("/api/event/delete/"+e).then(t=>{t.data.error||this.events.edit._id!=t.data.id?this.alert.normalText="No pudo eliminarse el evento":(this.deleteFrontEndItem(this.events.items,e),this.events.edit={},this.loading.normalText="Se eliminó exitosamente el evento."),UIkit.modal(document.getElementById("edit-event")).toggle()})},deleteUserFromEvent(e,t){axios.get("/api/user/delete/classFromUser/"+t).then(t=>{let s=0;if(t.data.error)this.alert.modalText=`No se pudo eliminar a ${this.customers.items[s].name} del seminario.`;else{this.loading.modalText=`Se eliminó correctamente a ${this.customers.items[s].name} del seminario`;this.deleteFrontEndItem(this.customers.items,e)}}).catch(this.alert.modalText="Hubo un error de red.")},getCustomers(e){this.loading.normalText="Cargando clientes",0==this.customers.items.length?axios.get("/api/user/get/"+e).then(e=>{e.data.error?this.alert.normalText="No se pudieron encontrar todos los usuarios":(this.customers.items=[...e.data.result],this.customers.items=this.customers.items.reverse(),this.loading.normalText="")}):this.loading.normalText=""},editSuscription(e,t){let s={method:"post",url:"/api/user/edit/suscription",data:{userId:e,classId:t,data:{couponCode:document.getElementById(`couponCode_${e}`).innerText,couponCodeSec:document.getElementById(`couponCodeSec_${e}`)?document.getElementById(`couponCodeSec_${e}`).innerText:""}}};axios(s).then(t=>{if(t.data.error)this.alert.modalText="No se puede editar la suscripción. ¿Quizá el teléfono está mal escrito?";else{let t=this.events.customers.map(function(e){return e._id}).indexOf(e);this.loading.modalText=`Has editado correctamente la suscripción de ${this.events.customers[t].name}.`}}).catch()},sendSuscriptionEmail(e,t){let s={method:"post",url:"/api/user/notify",data:{userId:e,classId:t}};axios(s).then(e=>{e.data.error?this.alert.modalText="El servicio de email no pudo re-enviar el correo":(this.loading.modalText="El email fue enviado correctamente.",this.events.customers.classes[0].notified=!0)}).catch(function(){this.alert.modalText="El sistema no se pudo conectar con el servicio de e-mails"})},deleteUserFromEvent(e,t,s){axios.get("/api/user/delete/classFromUser/"+t).then(t=>{let a=this.events.customers.map(function(e){return e._id}).indexOf(e);if(console.log(`response.data ${t.data.error}`),t.data.error||this.events.customers[a]._id!=e)this.alert.modalText="No se pudo eliminar este usuario de la clase";else{this.events.customers.splice(a,1),this.loading.modalText="Usuario eliminado de la clase correctamente";let e=this.events.items.map(function(e){return e._id}).indexOf(s);this.events.items[e].suscribers--}}).catch()},deleteUser(e){let t={method:"delete",url:"/api/user",data:{userId:e}};axios(t).then(t=>{if(t.data.error)this.alert.normalText="No pudo eliminarse este usuario.";else{this.deleteFrontEndItem(this.customers.items,e);this.loading.normalText="Se eliminó el usuario"}}).catch()},searchCustomers(){console.log("searchCustomers()"),this.customers.search.result=[],this.loading.modalText="",this.alert.modalText="";let e={url:"/api/user/search",method:"POST",data:{filter:this.customers.search.filter,key:this.customers.search.key}};axios(e).then(e=>{e.data.error?this.alert.modalText="Hay un error en la búsqueda o no se encontraron coincidencias.":(this.customers.search.result=[...e.data.result],this.loading.modalText="Los datos se descargaron correctamente.")}).catch()},getDestinations(){let e=[];for(let t=0;t<this.events.customers.length;t++)console.log(`Se revisa ${this.events.customers[t].email}`),this.customers.selected.items[t]&&(console.log(`Se añade ${this.events.customers[t].email}`),e.push({email:this.events.customers[t].email}));if(0==e.length)for(let t=0;t<this.events.customers.length;t++)e.push({email:this.events.customers[t].email});return console.log(e),e},emailWizard(){if(this.customers.selected.activated){this.alert.modalText="",this.loading.modalText="";let e=this.getDestinations();if(document.getElementById("emailTxt").value.length>=10){let t={url:"/api/user/notify/custom",method:"POST",data:{destinations:e,message:document.getElementById("emailTxt").value}};console.log(t),axios(t).then(e=>{this.loading.modalText="Se ha enviado el correo exitosamente."}).catch()}else this.alert.modalText="Has escrito un mensaje muy corto."}else this.customers.selected.items.length=this.events.customers.length,this.customers.selected.activated=!0},shutdownEmailWizard(){this.customers.selected.activated=!1,this.loading.modalText="",this.alert.modalText=""}},delimiters:["[[","]]"]});setInterval(function(){window.navigator.onLine||(panel.alert.normalText="No tienes internet",this.online=window.navigator.onLine)},3e3);